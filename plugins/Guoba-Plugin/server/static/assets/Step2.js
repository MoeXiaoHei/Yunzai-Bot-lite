var e=(e,t,s)=>new Promise(((a,n)=>{var i=e=>{try{r(s.next(e))}catch(t){n(t)}},o=e=>{try{r(s.throw(e))}catch(t){n(t)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,o);r((s=s.apply(e,t)).next())}));import{a as t,b as s,r as a,G as n,H as i,w as o,q as r,e as l,o as u,f as p,x as d,k as c,ae as m,aj as y,i as f,j,R as v,F as x,l as g,bx as k,ah as h,ai as w,bB as b}from"./index.js";import{P as _,A as F}from"./BasicForm.js";import{u as A}from"./hooks.js";import"./index5.js";import"./find.js";import"./_baseIteratee.js";import"./get.js";import"./index4.js";import"./index9.js";import"./useFormItem.js";/* empty css      */import"./transButton.js";import"./index2.js";import"./useWindowSizeFn.js";import"./FullscreenOutlined.js";import"./upperFirst.js";import"./download.js";import"./index7.js";import"./index6.js";import"./uniqBy.js";import"./lodash.default.js";import"./throttle.js";import"./merge.js";const I=e=>(h("data-v-258b8294"),e=e(),w(),e),P={class:"step-box"},T={key:0,class:"step-tip"},z={key:1,class:"step-tip"},B={key:2,class:"step-tip"},R=I((()=>y("span",null,"正在迁移中",-1))),S=I((()=>y("br",null,null,-1))),C=I((()=>y("br",null,null,-1))),O={style:{width:"90%"}},q=I((()=>y("br",null,null,-1))),H=g(" 迁移日志： "),G=g(" 返回重新选择配置 "),W=g(" 取消迁移 ");var $=t(s({__name:"Step2",setup(t){const{createConfirm:s}=b(),g=A(),h=a(),w=n((()=>3===g.status.state)),I=n((()=>g.status.reason)),$=n((()=>g.status.percent)),D=n((()=>g.status.logs.join("\n")));function E(){s({title:"取消迁移",iconType:"warning",content:"确定要取消迁移吗？取消后不会删除已迁移的文件，但下次迁移时就只能从头开始了。",onOk(){return e(this,null,(function*(){yield k.put({url:"/v2-transfer/stop"}),yield g.updateStatus()}))}})}function J(){s({title:"返回",iconType:"warning",content:"确定要重置迁移状态并返回吗？",onOk(){return e(this,null,(function*(){yield k.post({url:"/v2-transfer/reset"}),yield g.updateStatus()}))}})}return i((()=>{!function(){o(D,(()=>e(this,null,(function*(){var e,t;if(yield r(),null==(t=null==(e=h.value)?void 0:e.resizableTextArea)?void 0:t.textArea){let e=h.value.resizableTextArea.textArea;e.scrollTop=e.scrollHeight}}))),{immediate:!0,deep:!0})}(),o([$,w],(()=>{$.value>=100||w.value?g.stopPolling():g.startPolling()}),{immediate:!0})})),(e,t)=>{const s=l("a-textarea"),a=l("a-button"),n=l("a-col"),i=l("a-row");return u(),p("div",P,[d(w)?(u(),p("div",T,"迁移失败")):100===d($)?(u(),p("div",z,"迁移成功")):(u(),p("div",B,[R,c(d(m))])),S,c(d(_),{type:"circle",percent:d($),status:d(w)?"exception":void 0},null,8,["percent","status"]),C,y("div",O,[d(w)?(u(),f(d(F),{key:0,message:`迁移失败：${d(I)}`,type:"error","show-icon":""},null,8,["message"])):100===d($)?(u(),f(d(F),{key:1,message:"迁移成功！快去愉快地玩耍吧！",type:"success","show-icon":""})):(u(),f(d(F),{key:2,message:"在迁移结束之前，请勿重启或关闭云崽",type:"warning","show-icon":""})),q,H,c(s,{ref_key:"logRef",ref:h,value:d(D),"auto-size":{minRows:10,maxRows:10}},null,8,["value"]),100!==d($)?(u(),f(i,{key:3,class:"footer-btn"},{default:j((()=>[c(n,{span:12},{default:j((()=>[d(w)?(u(),f(a,{key:0,type:"link",preIcon:"ant-design:undo",onClick:J},{default:j((()=>[G])),_:1})):v("",!0)])),_:1}),c(n,{span:12,style:{"text-align":"right"}},{default:j((()=>[d(w)?(u(),p(x,{key:0},[],64)):(u(),f(a,{key:1,type:"link",danger:"",preIcon:"ant-design:close-circle",onClick:E},{default:j((()=>[W])),_:1}))])),_:1})])),_:1})):v("",!0)])])}}}),[["__scopeId","data-v-258b8294"]]);export{$ as default};
