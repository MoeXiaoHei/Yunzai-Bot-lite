var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,l,o)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[l]=o,i=(e,t)=>{for(var l in t||(t={}))n.call(t,l)&&a(e,l,t[l]);if(o)for(var l of o(t))s.call(t,l)&&a(e,l,t[l]);return e},r=(e,o)=>t(e,l(o)),c=(e,t,l)=>new Promise(((o,n)=>{var s=e=>{try{i(l.next(e))}catch(t){n(t)}},a=e=>{try{i(l.throw(e))}catch(t){n(t)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,a);i((l=l.apply(e,t)).next())}));import{B as u}from"./TableImg.js";import"./BasicForm.js";import{p as d,ag as m,r as p,c as f,w as h,x as g,bB as x,b,du as v,z as w,bx as j,k as S,e as y,l as C,a as R,o as O,i as I,j as P,V as B,aj as k,R as _}from"./index.js";import{B as F,a as K}from"./index2.js";/* empty css      */import"./index14.js";import"./index16.js";import"./onMountedOrActivated.js";import"./useWindowSizeFn.js";import"./useContentViewHeight.js";import"./ArrowLeftOutlined.js";import"./transButton.js";import"./index4.js";import"./index9.js";import"./merge.js";import"./upperFirst.js";import"./_baseIteratee.js";import"./get.js";import"./sortable.esm.js";import"./RedoOutlined.js";import"./FullscreenOutlined.js";import"./scrollTo.js";import"./index21.js";import"./index22.js";import"./index5.js";import"./find.js";import"./useFormItem.js";import"./download.js";import"./index7.js";import"./index6.js";import"./uniqBy.js";const T={isRadioSelection:d.bool.def(!1),rowKey:d.string.def("id"),labelKey:d.string.def("name"),params:d.object.def((()=>({}))),showButton:d.bool.def(!0),showSelected:d.bool.def(!1),maxSelectCount:d.number.def(0),modalTitle:d.string.def("选择")};function z(e,t){const l=m("selectOptions",p([])),o=m("selectValues",f({value:[],change:!1})),n=m("loadingEcho",p(!1)),s=p([]),a=p([]),i=p([]),r=x();let u=!0;function d(l,o){return c(this,null,(function*(){if(a.value=l,t.showSelected&&g(a).length!==g(o).length){let{records:t}=yield e({code:g(a).join(","),pageSize:g(a).length});i.value=t}else i.value=o}))}h(o,(()=>{if(0==o.change){let e={};e[t.rowKey]=o.value.join(","),n.value=u,u=!1,v(e,!0).then().finally((()=>{n.value=u}))}a.value=o.value}),{immediate:!0});const b={type:t.isRadioSelection?"radio":"checkbox",columnWidth:40,selectedRowKeys:a,onChange:d};function v(o,n){return c(this,null,(function*(){let{records:a}=yield e(o);if(s.value=a,n){let e=[];a.forEach((l=>{e.push({label:l[t.labelKey],value:l[t.rowKey]})})),l.value=e}}))}return[{onSelectChange:d,getDataSource:v,visibleChange:function(l){return c(this,null,(function*(){l&&t.showSelected&&function(){c(this,null,(function*(){let{records:t}=yield e({code:o.value.join(","),pageSize:o.value.length});a.value=o.value,i.value=t}))}()}))},selectOptions:l,selectValues:o,rowSelection:b,indexColumnProps:{dataIndex:"index",title:"#",width:40},checkedKeys:a,selectRows:i,dataSource:s,getSelectResult:function(e){let o=[],n=[];if(i.value.forEach((e=>{o.push({label:e[t.labelKey],value:e[t.rowKey]})})),a.value.forEach((e=>{n.push(e)})),l.value=o,t.maxSelectCount&&n.length>t.maxSelectCount)return r.createMessage.warning(`最多只能选择${t.maxSelectCount}条数据`),!1;e&&e(o,n)},handleDeleteSelected:function(e){a.value=a.value.splice(a.value.indexOf(e.id),1),i.value=i.value.filter((t=>t.id!==e.id))},reset:function(){a.value=[],i.value=[]}}]}function V(e){return j.get({url:"/oicq/friend/list",params:e})}var q=b({name:"UserSelectModal",components:{BasicModal:F,BasicTable:u,FormItemRest:v},props:r(i({},T),{modalTitle:d.string.def("选择好友")}),emits:["register","getSelectResult"],setup(e,{emit:t}){const l=w(),o=p(),n=Object.assign({},g(e),g(l),{canResize:!1,bordered:!0,size:"small"}),[{rowSelection:s,visibleChange:a,selectValues:c,indexColumnProps:u,getSelectResult:d,handleDeleteSelected:m,selectRows:f}]=z(V,n),h=p({x:!1}),[x,{closeModal:b}]=K((()=>{window.innerWidth<900?h.value={x:900}:h.value={x:!1},setTimeout((()=>{o.value&&o.value.setSelectedRowKeys(c.value||[])}),800)})),v=[{title:"头像",dataIndex:"user_id",width:60,customRender:({text:e})=>S(y("g-avatar"),{id:e,qs:100},null)},{title:"QQ号",dataIndex:"user_id",width:120},{title:"昵称",dataIndex:"nickname",ellipsis:!0,align:"left",customRender:({text:e,record:t})=>t.remark!==e?S("span",null,[S("span",null,[t.remark]),S("span",{style:"color:#999;font-size:8px;"},[C("（"),e,C("）")])]):e},{title:"性别",dataIndex:"sex",width:60,customRender:({text:e})=>"female"===e?"女":"male"===e?"男":e}];return{handleOk:function(){d(((e,l)=>{t("getSelectResult",e,l),b()}))},searchInfo:p(e.params),register:x,indexColumnProps:u,visibleChange:a,getBindValue:n,getFriendList:V,formConfig:{baseColProps:{xs:24,sm:8,md:6,lg:8,xl:8,xxl:8},actionColOptions:{xs:24,sm:8,md:8,lg:8,xl:8,xxl:8,style:{paddingLeft:"8px",textAlign:"left"}},labelCol:{xs:24,sm:6},wrapperCol:{xs:24,sm:18},schemas:[{label:"QQ号",field:"query_qq",component:"Input",componentProps:{placeholder:"请输入QQ号"}},{label:"昵称",field:"query_name",component:"Input",componentProps:{placeholder:"请输入昵称"}}],autoSubmitOnEnter:!0},columns:v,rowSelection:s,selectRows:f,selectedTable:{rowKey:"user_id",size:"small",bordered:!0,scroll:{y:390},canResize:!1,pagination:!1,showIndexColumn:!1,columns:[v[0],r(i({},v[1]),{show:!1}),v[2]]},handleDeleteSelected:m,tableScroll:h,tableRef:o}}});const D=["onClick"];var E=R(q,[["render",function(e,t,l,o,n,s){const a=y("BasicTable"),i=y("a-col"),r=y("Icon"),c=y("a-row"),u=y("BasicModal"),d=y("FormItemRest");return O(),I(d,null,{default:P((()=>[S(u,B({width:"800px",title:e.modalTitle,onOk:e.handleOk,onRegister:e.register,onVisibleChange:e.visibleChange},e.$attrs),{default:P((()=>[S(c,null,{default:P((()=>[S(i,{span:e.showSelected?18:24},{default:P((()=>[S(a,B({ref:"tableRef",columns:e.columns,scroll:e.tableScroll},e.getBindValue,{useSearchForm:!0,formConfig:e.formConfig,api:e.getFriendList,searchInfo:e.searchInfo,rowSelection:e.rowSelection,indexColumnProps:e.indexColumnProps}),null,16,["columns","scroll","formConfig","api","searchInfo","rowSelection","indexColumnProps"])])),_:1},8,["span"]),e.showSelected?(O(),I(i,{key:0,span:6},{default:P((()=>[S(a,B(e.selectedTable,{dataSource:e.selectRows,useSearchForm:!0,formConfig:{showActionButtonGroup:!1,baseRowStyle:{minHeight:"40px"}}}),{action:P((({record:t})=>[k("a",{onClick:l=>e.handleDeleteSelected(t)},[S(r,{icon:"ant-design:delete-outlined"})],8,D)])),_:1},16,["dataSource"])])),_:1})):_("",!0)])),_:1})])),_:1},16,["title","onOk","onRegister","onVisibleChange"])])),_:1})}]]);export{E as default};
