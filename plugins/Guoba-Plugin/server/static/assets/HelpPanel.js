var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,o,l)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l,s=(e,t,o)=>new Promise(((l,a)=>{var n=e=>{try{s(o.next(e))}catch(t){a(t)}},i=e=>{try{s(o.throw(e))}catch(t){a(t)}},s=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,i);s((o=o.apply(e,t)).next())}));import r from"./EditBodyModal.js";import{b as p,fU as c,eM as d,Q as m,r as u,w as h,e as g,o as b,f,aj as v,k as y,j,N as B,m as C,F as x,h as $,i as L,x as w,R as k,fj as D,U as O,l as M,ab as I,bB as S}from"./index.js";import{u as P}from"./index2.js";import{c as U}from"./common.js";import{HelpTable as N}from"./HelpComps.js";import F from"./UploadIconHelpModal.js";import{b as R,a as _}from"./miao.api.js";import{l as z}from"./lodash.default.js";import"./index9.js";import"./SelectIconModal.js";import"./IconUploader.js";import"./esm.js";import"./useWindowSizeFn.js";import"./FullscreenOutlined.js";import"./21ae6624.js";import"./base64Conver.js";import"./upperFirst.js";import"./_baseIteratee.js";import"./get.js";import"./find.js";import"./throttle.js";import"./merge.js";import"./uniqBy.js";const E={class:"container"},W={class:"setting-box"},A=v("input",{type:"file",id:"upload-bg",style:{display:"none"},name:"icon",accept:"image/bmp,image/jpeg,image/png"},null,-1),H=v("input",{type:"file",id:"upload-icon",style:{display:"none"},name:"icon",accept:"image/png"},null,-1),T={class:"info-box"},V={class:"head-box type"},q={class:"title"},Q={class:"label"},Y=["onClick"],G={class:"copyright"},J=M(" Created By Yunzai-Bot "),K={class:"version"},X=M(" & Miao-Plugin "),Z={class:"version"},ee=p({__name:"HelpPanel",props:{helpCfg:Object,helpList:Object,bgB64:String,mainB64:String,cacheVer:Number,themeName:String,themeNames:Array,iconB64List:Array,modelData:Object,themeStyle:Object,versions:Object},emits:["update:themeStyle","update:modelData","update:mainB64","update:iconB64List","open-setting"],setup(e,{emit:p}){const M=e,ee=c(),te=d(),{prefixCls:oe}=m("miao-plugin-help-panel"),{createMessage:le}=S(),[ae,ne]=P(),ie=u(1),se=u(3),re=u(850),pe=()=>{let e=function(){let{helpCfg:e}=M;if(!e)return{style:"",colCount:3};let t=Math.min(5,Math.max(parseInt(null==e?void 0:e.colCount)||3,2)),o=Math.min(500,Math.max(100,parseInt(null==e?void 0:e.colWidth)||265)),l=Math.min(2500,Math.max(800,t*o+30)),a=[];a.push(`.${oe} { width:${l}px; }`),a.push(`.${oe} .help-table .td,.help-table .th{width:${100/t}%}`);let n=`/api/plugin/miao/help/theme/$s?token=${te.liteToken}&themeName=${M.themeName}&_v=${M.cacheVer}`,i=n.replace("$s","bg"),s=n.replace("$s","main");M.mainB64&&(s=M.mainB64);let r=`background: url(${s}) top left/100% auto no-repeat,url(${i})`;a.push(`.${oe} .container { width:${l}px; ${r}; }`);let p=function(e,t,o,l,n){let i=function(...e){for(let t of e)if(!z.isUndefined(t))return t}(M.themeStyle[o],l);n&&(i=n(i)),a.push(`.${oe} ${e}{${t}:${i}}`)};return p(".help-title,.help-group","color","fontColor","#ceb78b"),p(".help-title,.help-group","text-shadow","fontShadow","none"),p(".help-desc","color","descColor","#eee"),p(".cont-box","background","contBgColor","rgba(43, 52, 61, 0.8)"),p(".cont-box","backdrop-filter","contBgBlur",3,(t=>!1===(null==e?void 0:e.bgBlur)?"none":`blur(${t}px)`)),p(".help-group","background","headerBgColor","rgba(34, 41, 51, .4)"),p(".help-table .tr:nth-child(odd)","background","rowBgColor1","rgba(34, 41, 51, .2)"),p(".help-table .tr:nth-child(even)","background","rowBgColor2","rgba(34, 41, 51, .4)"),{style:`${a.join("\n")}`,width:l,colCount:t}}();e.style&&U(e.style,oe),re.value=e.width||850,se.value=e.colCount},ce=I(pe,300);h([()=>M.helpCfg,()=>M.themeName],ce,{immediate:!0,deep:!0}),h((()=>M.themeStyle),pe,{immediate:!0,deep:!0}),h(re,(e=>{document.body.clientWidth>=e?ie.value=1:ie.value=parseFloat((document.body.clientWidth/e).toFixed(4))}),{immediate:!0}),u([{event:"changeBackground",text:"更换背景",icon:"akar-icons:image",onClick(){me("upload-bg",(e=>{p("update:mainB64",e)}))}},{event:"uploadIcon",text:"上传图标",icon:"fontisto:nav-icon-grid",onClick(){let e=()=>{me("upload-icon",(e=>s(this,null,(function*(){let t=yield _(e);p("update:iconB64List",t),le.success("上传成功")}))))};!0===ee.get("hide-upload-icon-help-modal",!1)?e():ne.openModal(!0,e)}}]),h((()=>M.themeName),(e=>s(this,null,(function*(){p("update:themeStyle",yield R(e))}))),{immediate:!0});const de={};function me(e,t){let o=document.getElementById(e);de[e]||(de[e]=!0,o.addEventListener("change",(e=>{let l=e.target.files;if(0!==l.length){let e=l[0],a=new FileReader;a.readAsDataURL(e),a.onload=()=>{t(a.result),o.value=null}}}))),o.click()}const ue=(e,t,o,l)=>{var a,n;let i=!0;(null==(a=M.modelData)?void 0:a.show)&&e&&e===(null==(n=M.modelData)?void 0:n.cell)&&(i=!1),p("update:modelData",{show:i,cell:e,cellIndex:t,group:o,groupIndex:l})};function he(){var e;p("open-setting"),p("update:modelData",(e=((e,t)=>{for(var o in t||(t={}))a.call(t,o)&&i(e,o,t[o]);if(l)for(var o of l(t))n.call(t,o)&&i(e,o,t[o]);return e})({},M.modelData),t(e,o({show:!1}))))}return(t,o)=>{const l=g("Icon"),a=g("a-button");return b(),f("div",{class:O([w(oe)]),style:B(`transform: scale(${ie.value});transform-origin: center top;`)},[v("div",E,[v("div",W,[A,H,y(a,{style:B(`transform: scale(${1/ie.value});transform-origin: right top;`),type:"primary",shape:"circle",size:"large",onClick:he},{default:j((()=>[y(l,{icon:"ion:settings-outline"})])),_:1},8,["style"])]),v("div",T,[v("div",V,[v("div",q,C(e.helpCfg.title),1),v("div",Q,C(e.helpCfg.subTitle),1)])]),(b(!0),f(x,null,$(e.helpList,((t,o)=>{var l;return b(),f("div",{class:"cont-box",key:o},[v("div",{class:"help-group",onClick:e=>ue(null,null,t,o)},[v("span",null,C(t.group),1)],8,Y),(null==(l=t.list)?void 0:l.length)?(b(),L(w(N),{key:0,list:t.list,colCount:se.value,iconB64List:e.iconB64List,modelData:e.modelData,onOpen:(e,l)=>ue(e,l,t,o)},null,8,["list","colCount","iconB64List","modelData","onOpen"])):k("",!0)])})),128)),v("div",G,[J,v("span",K,C(e.versions.yunzai),1),X,v("span",Z,C(e.versions.miao),1)])]),y(r,{panelCls:w(oe),helpList:e.helpList,"onUpdate:helpList":o[0]||(o[0]=e=>D(helpList)?helpList.value=e:null),modelData:e.modelData,"onUpdate:modelData":o[1]||(o[1]=e=>D(modelData)?modelData.value=e:null),iconB64List:e.iconB64List,"onUpdate:iconB64List":o[2]||(o[2]=e=>D(iconB64List)?iconB64List.value=e:null)},null,8,["panelCls","helpList","modelData","iconB64List"]),y(F,{onRegister:w(ae)},null,8,["onRegister"])],6)}}});export{ee as default};
