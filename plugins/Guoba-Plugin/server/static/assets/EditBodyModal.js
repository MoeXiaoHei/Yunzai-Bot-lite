import{a as e,b as l,Q as a,r as t,G as s,fV as i,w as o,v as d,I as n,e as c,o as u,f as r,k as m,j as p,aj as v,i as f,bg as h,N as g,x,R as D,U as I,M as y,fj as b,F as w,l as k,ah as L,ai as C,bB as j}from"./index.js";import{S as _}from"./index9.js";import B from"./SelectIconModal.js";import"./IconUploader.js";import"./esm.js";const U=e=>(L("data-v-4baeee83"),e=e(),C(),e),M=[k(" 编辑内容 "),U((()=>v("span",{class:"tip"},"按住这里可拖动",-1)))],R={class:"p-4"},z={class:"row"},N=U((()=>v("div",null,"分组",-1))),O={class:"flex-1"},$={class:"row"},A=U((()=>v("div",null,"仅主人",-1))),E={class:"flex justify-between align-center flex-wrap"},S={class:"flex justify-start"},V={class:"flex flex-1 justify-end"},T=k("添加项目"),F=k("添加分组"),G=k("删除该组"),P={key:0},Q={class:"row"},q=U((()=>v("div",null,"标题",-1))),H={class:"flex-1"},J={class:"row"},K=U((()=>v("div",null,"描述",-1))),W={class:"flex-1"},X={class:"flex justify-between align-center"},Y={class:"flex justify-start move-buttons"},Z={class:"flex flex-1 justify-end"},ee=k("添加项目"),le=k("删除该项");var ae=e(l({__name:"EditBodyModal",props:{panelCls:String,helpList:Object,modelData:Object,iconB64List:Array},emits:["update:modelData"],setup(e,{emit:l}){const k=e,{prefixCls:L}=a("miao-plugin-edit-modal"),{createConfirm:C}=j(),U=t(!0),ae=s((()=>U.value?"model-event-none":"")),te=t(!1);let se=!1;const ie=()=>{let e=k.modelData.groupIndex;k.helpList.splice(e,0,{group:"未命名分组",list:[]}),k.modelData.group=k.helpList[e],k.modelData.cellIndex=k.modelData.cell=null},oe=()=>{var e;let l=k.helpList[k.modelData.groupIndex];Array.isArray(l.list)||(l.list=[]);let a=null!=(e=k.modelData.cellIndex)?e:0;l.list.splice(a,0,{icon:1,title:"未命名项目",desc:"请添加描述"}),k.modelData.cell=l.list[a],k.modelData.cellIndex=a},de=e=>{let l,a=k.helpList,t=k.modelData.groupIndex;l=a[t],a[t]=a[t+e],a[t+e]=l,k.modelData.groupIndex+=e},ne=e=>{if(-1===e&&0===k.modelData.cellIndex)return void ce(e);if(1===e&&k.modelData.cellIndex===k.helpList[k.modelData.groupIndex].list.length-1)return void ce(e);let l,a=k.helpList[k.modelData.groupIndex].list,t=k.modelData.cellIndex;l=a[t],a[t]=a[t+e],a[t+e]=l,k.modelData.cellIndex+=e};function ce(e){let a=-1===e?"上":"下";U.value=!1,C({title:"跨分组移动",iconType:"warning",content:`确定要将该项目移动到${a}一个分组吗？`,onOk:()=>{let a,{modelData:t,helpList:s}=k,{cell:i,groupIndex:o,cellIndex:d}=t,n=s[o],c=s[o+e];-1===e?(c.list.push(i),n.list.splice(d,1),a=c.list.length-1):(c.list.unshift(i),n.list.splice(d,1),a=0),l("update:modelData",Object.assign(t,{cellIndex:a,group:c,groupIndex:o+e}))},afterClose:()=>U.value=!0})}function ue(e){let{modelData:l,helpList:a}=k;return-1===e?0===l.groupIndex&&0===l.cellIndex:1===e&&(l.groupIndex===a.length-1&&l.cellIndex===a[l.groupIndex].list.length-1)}const re=()=>{k.helpList.splice(k.modelData.groupIndex,1),k.modelData.show=!1},me=()=>{let e=k.helpList[k.modelData.groupIndex],l=k.modelData.cellIndex;if(e.list.splice(l,1),0==e.list.length)k.modelData.cell=null,k.modelData.cellIndex=null;else{let a=l;a>=e.list.length&&(a=e.list.length-1),k.modelData.cell=e.list[a],k.modelData.cellIndex=a}},pe=()=>{te.value=!0,se=!0},ve=t(null),{x:fe,y:he,isDragging:ge}=i(ve),xe=t(0),De=t(0),Ie=t(!1),ye=t(0),be=t(0),we=t(0),ke=t(0),Le=t({left:0,right:0,top:0,bottom:0});o([fe,he],(()=>{if(!Ie.value){xe.value=fe.value,De.value=he.value;const e=document.body.getBoundingClientRect(),l=ve.value.getBoundingClientRect();Le.value.right=e.width-l.width,Le.value.bottom=e.height-l.height,we.value=ye.value,ke.value=be.value}Ie.value=!0})),o(ge,(()=>{ge||(Ie.value=!1)})),d((()=>{Ie.value&&(ye.value=we.value+Math.min(Math.max(Le.value.left,fe.value),Le.value.right)-xe.value,be.value=ke.value+Math.min(Math.max(Le.value.top,he.value),Le.value.bottom)-De.value)}));const Ce=s((()=>({transform:`translate(${ye.value}px, ${be.value}px)`})));function je(e){var l,a,t;if(null==(l=k.modelData)?void 0:l.show){if(!U.value)return;if(se)return;let l=e.composedPath();for(let e of l)if((null==(a=e.classList)?void 0:a.contains(L))||(null==(t=e.classList)?void 0:t.contains(k.panelCls)))return;k.modelData.show=!1}}function _e(){se=!1}return window.addEventListener("click",je),n((()=>{window.removeEventListener("click",je)})),(l,a)=>{const t=c("a-input"),s=c("Icon"),i=c("a-button"),o=c("a-popconfirm"),d=c("a-divider");return u(),r(w,null,[m(x(y),{visible:e.modelData.show,"onUpdate:visible":a[8]||(a[8]=l=>e.modelData.show=l),footer:null,mask:!1,class:I(x(L)),wrapClassName:x(ae)},{title:p((()=>[v("div",{ref_key:"modalTitleRef",ref:ve,style:{width:"100%",cursor:"move",margin:"0"}},M,512)])),modalRender:p((({originVNode:e})=>[v("div",{style:g(x(Ce))},[(u(),f(h(e)))],4)])),default:p((()=>[v("div",R,[v("div",z,[N,v("div",O,[m(t,{value:e.modelData.group.group,"onUpdate:value":a[0]||(a[0]=l=>e.modelData.group.group=l),placeholder:"分组"},null,8,["value"])])]),v("div",$,[A,m(x(_),{checked:e.modelData.group.auth,"onUpdate:checked":a[1]||(a[1]=l=>e.modelData.group.auth=l),checkedValue:"master","checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),v("div",E,[v("div",S,[m(i,{class:"ml-4",disabled:0===e.modelData.groupIndex,type:"primary",shape:"circle",size:"medium",onClick:a[2]||(a[2]=e=>de(-1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-up"})])),_:1},8,["disabled"]),m(i,{class:"ml-4",disabled:e.modelData.groupIndex===e.helpList.length-1,type:"primary",shape:"circle",size:"medium",onClick:a[3]||(a[3]=e=>de(1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-down"})])),_:1},8,["disabled"])]),v("div",V,[e.modelData.cell?D("",!0):(u(),f(i,{key:0,class:"ml-4",onClick:oe},{default:p((()=>[T])),_:1})),m(i,{class:"ml-4",type:"success",onClick:ie},{default:p((()=>[F])),_:1}),m(o,{title:"确定删除？",onConfirm:re},{default:p((()=>[m(i,{class:"ml-4",type:"default",danger:""},{default:p((()=>[G])),_:1})])),_:1})])]),e.modelData.cell?(u(),r("div",P,[m(d,{style:{margin:"16px 0"}}),v("div",{class:"icon",onClick:pe,style:g(`background: url(${e.iconB64List[e.modelData.cell.icon]}) 0 0 no-repeat`)},null,4),v("div",Q,[q,v("div",H,[m(t,{value:e.modelData.cell.title,"onUpdate:value":a[4]||(a[4]=l=>e.modelData.cell.title=l),placeholder:"标题"},null,8,["value"])])]),v("div",J,[K,v("div",W,[m(t,{value:e.modelData.cell.desc,"onUpdate:value":a[5]||(a[5]=l=>e.modelData.cell.desc=l),placeholder:"描述"},null,8,["value"])])]),v("div",X,[v("div",Y,[m(i,{class:I(["ml-4",["ml-4",{warn:0===e.modelData.cellIndex}]]),disabled:ue(-1),type:"primary",shape:"circle",size:"medium",onClick:a[6]||(a[6]=e=>ne(-1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-left"})])),_:1},8,["class","disabled"]),m(i,{class:I(["ml-4",["ml-4",{warn:e.modelData.cellIndex===e.helpList[e.modelData.groupIndex].list.length-1}]]),disabled:ue(1),type:"primary",shape:"circle",size:"medium",onClick:a[7]||(a[7]=e=>ne(1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-right"})])),_:1},8,["class","disabled"])]),v("div",Z,[m(i,{class:"ml-4",type:"success",onClick:oe},{default:p((()=>[ee])),_:1}),m(o,{title:"确定删除？",onConfirm:me},{default:p((()=>[m(i,{class:"ml-4",type:"default",danger:""},{default:p((()=>[le])),_:1})])),_:1})])])])):D("",!0)])])),_:1},8,["visible","class","wrapClassName"]),e.modelData.cell?(u(),f(B,{key:0,visible:te.value,"onUpdate:visible":a[9]||(a[9]=e=>te.value=e),cell:e.modelData.cell,"onUpdate:cell":a[10]||(a[10]=l=>e.modelData.cell=l),iconB64List:e.iconB64List,"onUpdate:iconB64List":a[11]||(a[11]=e=>b(iconB64List)?iconB64List.value=e:null),afterClose:_e},null,8,["visible","cell","iconB64List"])):D("",!0)],64)}}}),[["__scopeId","data-v-4baeee83"]]);export{ae as default};
